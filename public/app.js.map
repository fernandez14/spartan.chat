{"version":3,"sources":["app/chat.js","app/initialize.js","app/socket.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5RA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhEA;AAAA","file":"public/app.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Chat = Chat;\n\nvar _dom = require('@cycle/dom');\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _debounce = require('xstream/extra/debounce');\n\nvar _debounce2 = _interopRequireDefault(_debounce);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ENTER_KEY = 13;\nvar ESC_KEY = 27;\n\n/**\r\n *\r\n * @param dom\r\n */\nfunction intent(dom, socket) {\n    var msg$ = dom.select('.message').events('keyup').filter(function (e) {\n        var trimmed = String(e.target.value).trim();\n        return trimmed;\n    }).map(function (e) {\n        return { type: 'message', sent: e.keyCode == ENTER_KEY, payload: String(e.target.value) };\n    });\n\n    var scroll$ = dom.select('.list-container').events('scroll').compose((0, _debounce2.default)(25)).map(function (e) {\n        return { type: 'feed-scroll', top: e.target.scrollTop, height: e.target.scrollHeight - e.target.clientHeight };\n    });\n\n    var channel$ = dom.select('.channel').events('click').map(function (e) {\n        return e.target.dataset.id;\n    }).startWith('general');\n\n    var messages$ = channel$.map(function (name) {\n        return socket.get('chat ' + name);\n    }).flatten();\n\n    return { msg$: msg$, scroll$: scroll$, messages$: messages$, channel$: channel$ };\n};\n\n/**\r\n *\r\n * @param actions$\r\n * @returns {MemoryStream|MemoryStream<{list: Array, message: string}>}\r\n */\nfunction model(actions) {\n    var scroll$ = actions.scroll$.map(function (a) {\n        return { lock: a.top == a.height };\n    }).startWith({ lock: true }).map(function (status) {\n        return function (state) {\n            return Object.assign({}, state, { lock: status.lock });\n        };\n    });\n\n    var currentChannel$ = actions.channel$.map(function (channel) {\n        return function (state) {\n            return Object.assign({}, state, { channel: channel, list: [], lock: true });\n        };\n    });\n\n    var message$ = actions.msg$.map(function (message) {\n        return function (state) {\n            return Object.assign({}, state, { message: message.sent ? '' : message.payload });\n        };\n    });\n\n    var sent$ = actions.msg$.filter(function (m) {\n        return m.sent;\n    }).map(function (m) {\n        return { content: m.payload.trim(), user_id: 'nobody', username: 'nobody', avatar: false };\n    });\n\n    var packed$ = sent$.map(function (m) {\n        return { list: [m] };\n    });\n    var messages$ = _xstream2.default.merge(actions.messages$, packed$).map(function (packed) {\n        return function (state) {\n            return Object.assign({}, state, { list: state.list.concat(packed.list) });\n        };\n    });\n\n    var state$ = _xstream2.default.merge(messages$, message$, scroll$, currentChannel$).fold(function (state, action) {\n        return action(state);\n    }, { list: [], message: '', lock: true, channel: 'general' }).startWith({ list: [], message: '', lock: true, channel: 'general' });\n\n    var socketSend$ = _xstream2.default.combine(sent$, actions.channel$).map(function (send) {\n        return ['chat send', send[1], send[0].content];\n    });\n    var socketChannel$ = actions.channel$.map(function (channel) {\n        return ['chat update-me', channel];\n    });\n    var socket$ = _xstream2.default.merge(socketChannel$, socketSend$);\n\n    return {\n        state$: state$,\n        socket$: socket$\n    };\n};\nvar stream = false;\nvar users2 = false;\nvar users = false;\nvar channelName = \"\";\nvar favorite = {\n    status: false\n};\nvar show_details = false;\nvar admin = false;\n\nfunction view(state$) {\n    return state$.map(function (state) {\n        switch (state.channel) {\n            case 'general':\n                channelName = \"General\";\n                break;\n            case 'dia-de-hueva':\n                channelName = \"Día de hueva\";\n                break;\n        }\n        return (0, _dom.div)('.ng-scope', [(0, _dom.div)('#wrapper', { class: { \"stream\": stream } }, [!stream ? (0, _dom.div)('#page-content-wrapper', { class: { \"no-stream\": !stream, \"users\": users2 } }, [(0, _dom.div)('#panel', [(0, _dom.div)('.panel-title.panel-title-chat', [(0, _dom.p)([(0, _dom.a)([users2 ? (0, _dom.span)([(0, _dom.i)(\".fa.fa-circle\", {\n            \"attributes\": {\n                \"aria-hidden\": \"true\",\n                \"className\": \"fa fa-circle\"\n            },\n            \"style\": {\n                \"name\": \"style\",\n                \"value\": \"color: #3DE179;\"\n            }\n        }), \" N Spartanos conectados \"]) : \"\", !users2 ? (0, _dom.i)('.fa.fa-angle-double-right') : \"\", users2 ? (0, _dom.i)('.fa.fa-angle-double-left') : \"\"])])]), users2 ? (0, _dom.div)('.detail-section-chat.users', [(0, _dom.div)(\".search-box\", [(0, _dom.div)(\".input-group\", [(0, _dom.div)(\".input-group-addon\", [(0, _dom.i)(\".fa.fa-search\", {\n            \"attributes\": {\n                \"aria-hidden\": \"true\",\n                \"className\": \"fa fa-search\"\n            }\n        })]), (0, _dom.input)(\".form-control.mb-20.search\", {\n            \"attributes\": {\n                \"type\": \"text\",\n                \"ng-model\": \"searchText.content\",\n                \"placeholder\": \"Buscar\",\n                \"className\": \"form-control mb-20 search\"\n            }\n        })])]), (0, _dom.ul)('.user-status', [])]) : \"\"])]) : \"\", stream ? (0, _dom.div)('#page-content-wrapper', [(0, _dom.div)('#panelvideo', [(0, _dom.div)('.panel-title', [(0, _dom.div)(\".btn-group\", {\n            \"attributes\": {\n                \"role\": \"group\",\n                \"aria-label\": \"...\",\n                \"className\": \"btn-group\"\n            }\n        }, [(0, _dom.button)(\".btn.btn-default.channel\", {\n            \"attributes\": {\n                \"type\": \"button\"\n            },\n            class: { b: state.channel == 'general', \"active\": state.channel == 'general' },\n            dataset: { id: 'general' }\n        }, ['General']), (0, _dom.button)(\".btn.btn-default.channel\", {\n            \"attributes\": {\n                \"type\": \"button\"\n            },\n            class: { b: state.channel == 'dia-de-hueva', \"active\": state.channel == 'dia-de-hueva' },\n            dataset: { id: 'dia-de-hueva' }\n        }, ['D\\xEDa de hueva'])])]), (0, _dom.div)('.detail-section', [(0, _dom.div)(['youtube-media']), favorite.status ? (0, _dom.div)('.favorite-comment') : \"\", show_details && admin ? (0, _dom.div)('.detail-section', [(0, _dom.h4)([\"Configuración\"]), (0, _dom.form)('.form-inline', [(0, _dom.div)('.form-group', [(0, _dom.label)(['Código de Youtube']), (0, _dom.input)(\"#yt-code.form-control\", {\n            \"attributes\": {\n                \"type\": \"text\",\n                \"placeholder\": \"abcde123\"\n            }\n        })]), (0, _dom.button)(\".btn.btn-default\", {\n            \"attributes\": {\n                \"type\": \"submit\"\n            }\n        }, ['Actualizar video'])])]) : \"\"])])]) : \"\", (0, _dom.div)('#page-members-wrapper', { class: { \"no-stream\": !stream, \"users\": users2 } }, [admin && show_details && !stream ? (0, _dom.div)('.detail-section-admin', [(0, _dom.h4)([\"Configuración\"]), (0, _dom.form)('.form-inline', [(0, _dom.div)('.form-group', [(0, _dom.label)(['Código de Youtube']), (0, _dom.input)(\"#yt-code.form-control\", {\n            \"attributes\": {\n                \"type\": \"text\",\n                \"placeholder\": \"abcde123\"\n            }\n        })]), (0, _dom.button)(\".btn.btn-default\", {\n            \"attributes\": {\n                \"type\": \"submit\"\n            }\n        }, ['Actualizar video'])])]) : \"\", (0, _dom.div)('#panel', [!stream ? (0, _dom.div)(\".panel-title.panel-title-chat.un\", {\n            class: { \"stream\": stream },\n            style: { display: \"none\" }\n        }, [(0, _dom.p)([(0, _dom.a)({\n            \"attributes\": {\n                \"href\": \"#\"\n            }\n        }, [(0, _dom.i)(\".fa.fa-circle\", {\n            \"attributes\": {\n                \"aria-hidden\": \"true\"\n            },\n            style: {\n                color: \"#3DE179;\"\n            }\n        }), ' N Spartanos conectados\\xA0', !users ? (0, _dom.i)(\".fa.fa-caret-down\") : \"\", users ? (0, _dom.i)(\".fa.fa-caret-up\") : \"\"]), admin ? (0, _dom.a)(\".btn.btn-default.btn-icon.btn-round.icon-config\", {\n            class: { \"active\": show_details },\n            \"attributes\": {\n                \"title\": \"Configurar este canal\"\n            }\n        }, [(0, _dom.i)(\".fa.fa-fw.fa-info-circle.icon\")]) : \"\"])]) : \"\", !stream ? (0, _dom.div)('.panel-title.panel-title-chat', { class: { \"stream\": stream } }, [(0, _dom.div)(\".btn-group\", {\n            \"attributes\": {\n                \"role\": \"group\",\n                \"aria-label\": \"...\",\n                \"className\": \"btn-group\"\n            }\n        }, [(0, _dom.button)(\".btn.btn-default.channel\", {\n            \"attributes\": {\n                \"type\": \"button\"\n            },\n            class: { b: state.channel == 'general', \"active\": state.channel == 'general' },\n            dataset: { id: 'general' }\n        }, ['General']), (0, _dom.button)(\".btn.btn-default.channel\", {\n            \"attributes\": {\n                \"type\": \"button\"\n            },\n            class: { b: state.channel == 'dia-de-hueva', \"active\": state.channel == 'dia-de-hueva' },\n            dataset: { id: 'dia-de-hueva' }\n        }, ['D\\xEDa de hueva'])]), (0, _dom.span)([admin ? (0, _dom.a)(\".btn.btn-default.btn-icon.btn-round.icon-config\", {\n            class: { \"active\": show_details },\n            \"attributes\": {\n                \"title\": \"Configurar este canal\"\n            }\n        }, [(0, _dom.i)(\".fa.fa-fw.fa-info-circle.icon\")]) : \"\"])]) : \"\", stream ? (0, _dom.div)('.panel-title.panel-title-chat', { class: { \"stream\": stream } }, [(0, _dom.p)([(0, _dom.a)({\n            \"attributes\": {\n                \"href\": \"#\"\n            }\n        }, [(0, _dom.i)(\".fa.fa-circle\", {\n            \"attributes\": {\n                \"aria-hidden\": \"true\"\n            },\n            style: {\n                color: \"#3DE179;\"\n            }\n        }), ' N Spartanos conectados\\xA0', !users ? (0, _dom.i)(\".fa.fa-caret-down\") : \"\", users ? (0, _dom.i)(\".fa.fa-caret-up\") : \"\"]), admin ? (0, _dom.a)(\".btn.btn-default.btn-icon.btn-round.icon-config\", {\n            class: { \"active\": show_details },\n            \"attributes\": {\n                \"title\": \"Configurar este canal\"\n            }\n        }, [(0, _dom.i)(\".fa.fa-fw.fa-info-circle.icon\")]) : \"\"])]) : \"\", !users ? (0, _dom.div)('.detail-section-chat', { class: { \"stream\": !stream } }, [(0, _dom.div)('.content-chat', [(0, _dom.div)('.message-history', state.list.map(function (item, index, list) {\n            var simple = index > 0 && list[index - 1].user_id == item.user_id;\n            var tzoffset = new Date(item.timestamp).getTimezoneOffset() * 60000;\n            var formattedTime = new Date(Date.now() - tzoffset).toISOString().slice(-13, -5);\n            return (0, _dom.div)('.message', {\n                class: { \"compact\": simple },\n                hook: {\n                    insert: function insert(vnode) {\n                        if (state.lock) {\n                            vnode.elm.parentElement.parentElement.scrollTop = vnode.elm.parentElement.offsetHeight;\n                        }\n                    }\n                }\n            }, [simple == false ? (0, _dom.a)('.author', (0, _dom.img)('.avatar', { attrs: { src: item.avatar ? item.avatar : 'http://via.placeholder.com/40x40' } })) : \"\", simple == false ? (0, _dom.div)('.meta', [(0, _dom.a)('.username', item.username), (0, _dom.span)(\".timestamp\", \" \" + formattedTime)]) : \"\", simple ? (0, _dom.span)('.timestamp', formattedTime) : \"\", (0, _dom.div)('.content', item.content)]);\n        })), (0, _dom.div)('.footer', { class: { \"no-stream\": !stream } }, [(0, _dom.div)('.input-box', [(0, _dom.div)('.input-group', [(0, _dom.textarea)('.input-box_text.message.input-reset', {\n            props: {\n                placeholder: 'Escribe tu mensaje...',\n                value: state.message\n            }\n        })])])])])]) : \"\", users ? (0, _dom.div)('.detail-section-chat.users', { class: { \"stream\": !stream } }, [(0, _dom.div)(\".search-box\", [(0, _dom.div)(\".input-group\", [(0, _dom.div)(\".input-group-addon\", [(0, _dom.i)(\".fa.fa-search\", {\n            \"attributes\": {\n                \"aria-hidden\": \"true\"\n            }\n        })]), (0, _dom.input)(\".form-control.mb-20.search\", {\n            \"attributes\": {\n                \"type\": \"text\",\n                \"placeholder\": \"Buscar\"\n            }\n        })])]), (0, _dom.ul)('.user-status')]) : \"\"])])])]);\n    });\n}\n\nfunction Chat(sources) {\n    var actions$ = intent(sources.DOM, sources.socketIO);\n    var model$ = model(actions$);\n    var vtree$ = view(model$.state$);\n\n    return {\n        DOM: vtree$,\n        socketIO: model$.socket$\n    };\n};\n","'use strict';\n\nvar _socket = require('socket.io-client');\n\nvar _socket2 = _interopRequireDefault(_socket);\n\nvar _run = require('@cycle/run');\n\nvar _dom = require('@cycle/dom');\n\nvar _socket3 = require('./socket');\n\nvar _chat = require('./chat');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    var drivers = {\n        DOM: (0, _dom.makeDOMDriver)('#app'),\n        socketIO: (0, _socket3.makeSocketIODriver)((0, _socket2.default)('http://spartangeek.com:3100', { 'query': 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTY4YjA5ZjY3YTQ3ODAyY2EzNmNhMTE0Iiwic2NvcGUiOlsidXNlciIsImRldmVsb3BlciJdLCJleHAiOjE1MDE0MTA1MjQsImlzcyI6InNwYXJ0YW5nZWVrIn0.9_Y0pm8nQjNKN1_czEnFNClyBhwf70NMsiNwPeSNi_4' }))\n    };\n\n    (0, _run.run)(_chat.Chat, drivers);\n});\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.makeSocketIODriver = makeSocketIODriver;\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _adapt = require('@cycle/run/lib/adapt');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction makeSocketIODriver(socket) {\n    function get(eventName) {\n        var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n            _ref$multiArgs = _ref.multiArgs,\n            multiArgs = _ref$multiArgs === undefined ? false : _ref$multiArgs;\n\n        var socketStream$ = _xstream2.default.create({\n            start: function start(listener) {\n                this.eventListener = multiArgs ? function () {\n                    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                        args[_key] = arguments[_key];\n                    }\n\n                    return listener.next(args);\n                } : function (arg) {\n                    return listener.next(arg);\n                };\n\n                socket.on(eventName, this.eventListener);\n            },\n            stop: function stop() {\n                socket.removeListener(eventName, this.eventListener);\n            },\n\n            eventListener: null\n        });\n\n        return (0, _adapt.adapt)(socketStream$);\n    }\n\n    function publish(event) {\n        socket.emit.apply(socket, _toConsumableArray(event));\n    }\n\n    return function socketIODriver(events$) {\n        events$.addListener({\n            next: function next(event) {\n                return publish(event);\n            }\n        });\n\n        return {\n            get: get,\n            dispose: socket.destroy.bind(socket)\n        };\n    };\n}\n"]}